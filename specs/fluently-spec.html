<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ko">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
<title>JSSpec results</title>
<link rel="stylesheet" type="text/css" href="../jsspec/JSSpec.css" />
<script type="text/javascript" src="../jsspec/diff_match_patch.js"></script>
<script type="text/javascript" src="../jsspec/JSSpec.js"></script>
<script type="text/javascript" src="../fluently.js"></script>
<script type="text/javascript">//<![CDATA[
describe('Definitions', {
    'should call the right function': function() {
        var chain = Fluently.make(function(define) {
            define('a', function() {return 1});
            define('b', function() {return 2});
        });
        value_of(chain.a()).should_be(1);
        value_of(chain.b()).should_be(2);
    },
    'should chain': function() {
        var trace;
        var chain = Fluently.make(function(define) {
            define('reset', function() {trace = ''});
            define('a', function() {trace += 'a'});
            define('b', function() {trace += 'b'});
            define('trace', function() {return trace});
        });
        value_of(chain.reset().a().trace()).should_be('a');
        value_of(chain.reset().a().b().trace()).should_be('ab');
    },
    'should recognize aliases': function() {
        var chain = Fluently.make(function(define) {
            define('a', function() {return 1});
            define('b', function() {return 2});
            define.empty('self');
            define.alias('alias_a', 'a');
            define.alias('alias_b', 'b');
        });
        value_of(chain.self.a()).should_be(1);
        value_of(chain.alias_a()).should_be(1);
        value_of(chain.alias_b()).should_be(2);
        value_of(chain.self.alias_a()).should_be(1);
    },
    'should apply modifiers': function() {
        var trace;
        var options = {};
        options.reset = function() {
            for (var name in options)
                if (name != 'reset')
                    delete options[name];
        }
        function t(methodName) {
            var optionNames = [];
            for (var name in options)
                name == 'reset' || optionNames.push(name);
            optionNames.sort();
            spans = [methodName, '('];
            for (var ix = 0; ix < optionNames.length; ix++) {
                var name = optionNames[ix];
                ix && spans.push(',');
                spans.push(name);
                options[name] == true || spans.push(':', options[name]);
            }
            spans.push(')');
            trace += spans.join('');
        }
        var chain = Fluently.make(function(define) {
            define.modifier.dictionary(options);
            define.modifier('o1');
            define.modifier('o2');
            define('reset', function() {trace = ''; options.reset()});
            define('a', function() {t('a')});
            define('b', function() {t('b')});
            define('trace', function() {return trace});
        });
        value_of(chain.reset().a().trace()).should_be('a()');
        value_of(chain.reset().a().b().trace()).should_be('a()b()');
        value_of(chain.reset().o1.a().trace()).should_be('a(o1)');
        value_of(chain.reset().o2.a().trace()).should_be('a(o2)');
        // pending:
        // value_of(chain.reset().o1.o2.a().trace()).should_be('a(o1)');
    }
})
//]]></script>
</head>
<body><div style="display:none;"><p>A</p><p>B</p></div></body>
</html>
